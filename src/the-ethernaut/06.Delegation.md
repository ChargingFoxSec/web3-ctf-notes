# ⚙️ Challenge: Ethernaut – 06.Delegation

## 📜 Description / 原题描述

> The goal of this level is for you to claim ownership of the instance you are given.

> Things that might help

> - Look into Solidity's documentation on the delegatecall low level function, how it works, how it can be used to delegate operations to on-chain libraries, and what implications it has on execution scope.
>
> - Fallback methods
> - Method ids

```javascript
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract Delegate {
    address public owner;

    constructor(address _owner) {
        owner = _owner;
    }

    function pwn() public {
        owner = msg.sender;
    }
}

contract Delegation {
    address public owner;
    Delegate delegate;

    constructor(address _delegateAddress) {
        delegate = Delegate(_delegateAddress);
        owner = msg.sender;
    }

    fallback() external {
        (bool result,) = address(delegate).delegatecall(msg.data);
        if (result) {
            this;
        }
    }
}
```

---

## 🤔 Exploit Idea: delegatecall and proxy contract / 漏洞思路：代理调用以及代理合约

### That was my first time learning the concept of `delegatecall`.

### After reading some documentation about `delegatecall`, I learned that variables in the proxy contract can be modified by the logic contract.

---

## 🧠 Concept Summary / 概念总结

### 1、A contract can use `delegatecall` to use the logic of another contract.

### 2、The proxy contract and the logic contract must share the same storage layout.Storage variables are mapped by slot position,not by name.

---

## 🔬Proof of Concept / 概念证明

### 1、Call the pwn() function from the Delegate contract via the fallback() function in Delegation.

### 2、since it's the `fallback()` function,we can use the low-level call feature in Remix UI, with or without sending Ether (the value doesn’t matter).But first we need to use abi.encodeWithSignature("pwn()") to generate the function selector for pwn().

### If so, it will change the `address public owner` in `Delegation` contract.

---

## 📝 Notes

### - Delegatecall is a useful but dangerous feature in Solidity.
